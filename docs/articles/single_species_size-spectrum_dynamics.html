<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="In this tutorial you will gain an understanding of size-spectrum dynamics. To separate the size-spectrum effects from the multi-species effects, we will concentrate on a single species.">
<title>Single-species size-spectrum dynamics • mizer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Single-species size-spectrum dynamics">
<meta property="og:description" content="In this tutorial you will gain an understanding of size-spectrum dynamics. To separate the size-spectrum effects from the multi-species effects, we will concentrate on a single species.">
<meta property="og:image" content="https://sizespectrum.org/mizer/articles/single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-47-1.png">
<meta property="og:image:alt" content="mizer: Multi-Species Size Spectrum Modelling in R">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@mizer_model">
<meta name="twitter:site" content="@mizer_model">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mizer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.3.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/mizer.html">Get started</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/model_description.html">The General Mizer Size-spectrum Model</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Tutorials</h6>
    <a class="dropdown-item" href="../articles/single_species_size-spectrum_dynamics.html">Single-species size-spectrum dynamics</a>
    <a class="dropdown-item" href="../articles/community_model.html">The Community Model</a>
    <a class="dropdown-item" href="../articles/trait_model.html">The Trait-Based Model</a>
    <a class="dropdown-item" href="../articles/multispecies_model.html">The Multi Species Model</a>
    <a class="dropdown-item" href="../articles/running_a_simulation.html">Running a Simulation</a>
    <a class="dropdown-item" href="../articles/exploring_the_simulation_results.html">Exploring the Simulation Results</a>
    <a class="dropdown-item" href="../articles/a_multispecies_model_of_the_north_sea.html">A Multi-Species Model of the North Sea</a>
    <a class="dropdown-item" href="../articles/plotting.html">Using ggplot2 and plotly with mizer</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Publications</h6>
    <a class="dropdown-item" href="../articles/publications.html">Publications</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>For developers</h6>
    <a class="dropdown-item" href="../articles/developer_vignette.html">Developer Guide</a>
    <a class="dropdown-item" href="../articles/working_with_git.html">Working with git and GitHub</a>
    <a class="dropdown-item" href="../articles/developer_FAQ.html">Developer FAQ</a>
    <a class="dropdown-item" href="../articles/editing_website.html">Editing the Mizer Website</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://blog.mizer.sizespectrum.org">Blog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/mizer_model">
    <span class="fab fa fab fa-twitter fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sizespectrum/mizer/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Single-species size-spectrum dynamics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sizespectrum/mizer/blob/HEAD/vignettes/single_species_size-spectrum_dynamics.Rmd" class="external-link"><code>vignettes/single_species_size-spectrum_dynamics.Rmd</code></a></small>
      <div class="d-none name"><code>single_species_size-spectrum_dynamics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this tutorial you will gain an understanding of size-spectrum
dynamics. To separate the size-spectrum effects from the multi-species
effects, we will concentrate on a single species in this tutorial.</p>
<p>Size-spectrum dynamics describes in detail how biomass is transported
through the ecosystem from small sizes to large sizes. Thus the best way
to think about size-spectrum dynamics is to think of traffic on a
highway, except that instead of cars travelling along the road we have
fish growing along the size axis, all the way from their egg size to
their maximum size. Let us explore this analogy briefly.</p>
<!-- For traffic, you would be interested in modelling the traffic density.
From the traffic density we can obtain the number of cars in a section of
road by multiplying the density there by the length of the section. So the
traffic density has units of cars per meter. For fish populations, we
will be interested in modelling fish density. The number of fish in a size
class is obtained by multiplying the density in that size class by the 
width of the size class. So the fish density has units of fish per gram.  -->
<p>The flow of traffic on a highway is dependent on the traffic density,
which in turn is dependent on changes in the traffic velocity. High
traffic density arises in sections of the road where the traffic
velocity decreases. Such a decrease can lead to traffic jams. Low
traffic density arises in sections where the velocity increases, as
familiar when emerging on the other side of a traffic jam. Traffic jams
are self-reinforcing phenomena: if there is a decrease in speed
somewhere then the density of cars increases which causes a further
decrease in speed, leading to an even higher density, and so on.</p>
<p>Similarly, high fish density arises in size classes where the growth
rate decreases. A pronounced decrease in growth rate can lead to
pronounced peaks in the fish density, similar to a traffic jam. Of
course fish density is also controlled by the death rate, with a high
death rate leading to a decreased fish density.</p>
<p>To be precise, fish density in a size class increases if the rate at
which fish grow into the size class is larger than the rate at which
they either grow out of the size class or die while they are in the size
class. Thus size-spectrum dynamics is the result of the interplay
between the death rate and the changes in the growth rate. For the
mathematically minded, this interplay is expressed by the partial
differential equation <span class="math display">\[\frac{\partial}{\partial t}N(w,t) =
-\frac{\partial}{\partial w}\big(N(w,t)g(w,t)\big)
- \mu(w,t)\]</span> where <span class="math inline">\(N(w,t)\)</span> is
the fish density at size <span class="math inline">\(w\)</span> and time
<span class="math inline">\(t\)</span>, <span class="math inline">\(g(w,t)\)</span> is the growth rate of an
individual of size <span class="math inline">\(w\)</span> at time <span class="math inline">\(t\)</span> and <span class="math inline">\(\mu(w,t)\)</span> is its death rate. There is no
need for you to understand the mathematical notation.</p>
<p>Size-spectrum dynamics is like the traffic on a highway where cars
can leave the highway (fish can die) at any point, but they can only
join the highway at its beginning (fish start out at the egg size). To
model the size spectrum we therefore also have to describe the rate
<span class="math inline">\(R(t)\)</span> at which eggs are entering the
size spectrum, i.e., the rate at which mature fish reproduce.</p>
<p>Below we will be discussing in detail what determines the death rate
<span class="math inline">\(\mu(w,t)\)</span>, the growth rate <span class="math inline">\(g(w,t)\)</span> and the rate of reproduction <span class="math inline">\(R(t)\)</span>.</p>
</div>
<div class="section level2">
<h2 id="why-study-size-spectrum-dynamics">Why study size-spectrum dynamics?<a class="anchor" aria-label="anchor" href="#why-study-size-spectrum-dynamics"></a>
</h2>
<p>The study of traffic dynamics has had real practical benefits. For
example, at least on motorways in Europe, when there is a danger of a
traffic jam developing, automatic speed restrictions are imposed at a
certain distance in front of the developing slow-moving traffic. For
motorists who have not thought about traffic flow, these speed
restrictions in places where there is no obvious reason for them are
very annoying. However they do indeed avoid the formation of the traffic
jam.</p>
<p>Of course we can not directly tell fish to obey limits to their
growth rates. However we do have influence on their size-spectrum
dynamics through fishing policy. For example if some species experiences
stunted growth, like for example the Herring in the Baltic Sea, we could
resolve that by reducing their numbers (which increases their growth
rate because of reduced competition for food) or by reducing fishing on
their prey.</p>
<p>The size-spectrum dynamics in a multi-species ecosystem is extremely
complex. We can understand very simplified cases analytically, but in
general we need to use numerical simulation to understand the
consequences of various interventions.</p>
<p>The mizer package can simulate the size-spectrum dynamics. Given the
model parameters that enter into the expression of the growth rate, the
death rate and the reproductive rate, and an initial fish size spectrum,
mizer simulates the changes in the size spectrum over time according to
the above equations.</p>
<p>Of particular interest is the steady state of the size spectrum,
where the effects of the death rate and the changes in the growth rate
exactly balance in such a way that the size spectrum stays constant over
time. We will be looking both at the steady state and at time-varying
size spectra below.</p>
<p>Our emphasis will be on understanding the dynamics. We do not just
want to learn how to run simulations but we want to use the simulations
to develop an intuition for how fish populations behave. We therefore
start with very simple models first.</p>
</div>
<div class="section level2">
<h2 id="a-first-example">A first example<a class="anchor" aria-label="anchor" href="#a-first-example"></a>
</h2>
<p>The most effective way of working with this tutorial is to open up an
R script file in RStudio and copying all the commands from this tutorial
into that R script file. You should then execute them by sending them to
the R console, thereby reproducing all the results. Later in this
tutorial there will be exercises that you can do by adapting the code in
your R script file to the tasks in the exercises. That way you will pick
up a facility in working with mizer in R at the same time as gaining a
deeper understanding of size spectrum modelling.</p>
<p>First, load some required packages with the following commands:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sizespectrum.org/mizer/">mizer</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com" class="external-link">plotly</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>If you get error messages saying that a particular package is not
available, you will need to install that package.</p>
<p>Mizer collects all the parameters describing a size-spectrum model
into one object of class <code>MizerParams</code>. You do not need to
set up this object by hand but instead there are several wrapper
functions in mizer that create the object for you for various types of
models, and also many functions for changing specific parameters in a
model. We will use the <code><a href="../reference/newSingleSpeciesParams.html">newSingleSpeciesParams()</a></code> function to
set up a model describing a single fish species living in an ecosystem
whose community size spectrum is given by a power-law.</p>
<p>The <code><a href="../reference/newSingleSpeciesParams.html">newSingleSpeciesParams()</a></code> function has many arguments
that allow you to specify parameters for the fish species as well as for
the community, but all these arguments have default values, so we can
simply call the function without specifying those arguments. We will
only specify the power-law exponent of the background community</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newSingleSpeciesParams.html">newSingleSpeciesParams</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">2.05</span><span class="op">)</span></span></code></pre></div>
<p>The function returns a <code>MizerParams</code> object and we have
assigned that to the variable <code>params</code>. We will be explaining
more about this model as we go along.</p>
</div>
<div class="section level2">
<h2 id="steady-state-spectrum">Steady state spectrum<a class="anchor" aria-label="anchor" href="#steady-state-spectrum"></a>
</h2>
<p>The <code>params</code> object also contains an initial size spectrum
that is close to the steady state of the model. The steady state is the
state where in each size class the inflow of individuals through growth
exactly balances the outflow of individuals through growth and death. If
we start close to the steady state then usually if we simulate the
size-spectrum dynamics for a while the population will evolve closer and
closer to the steady state.</p>
<p>To get to the steady state we use the <code><a href="../reference/steady.html">steady()</a></code> function.
The result of that function is again a MizerParams object but now with
an initial size spectrum that has evolved to be very close to the steady
state.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/steady.html">steady</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Convergence was achieved in 1.5 years.</span></span></code></pre>
<p>We can plot the size spectrum with the <code><a href="../reference/plotSpectra.html">plotSpectra()</a></code>
function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">params</span>, power <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The <code>power = 0</code> argument to the <code><a href="../reference/plotSpectra.html">plotSpectra()</a></code>
function specifies that we want to plot the number density, rather than
for example the biomass density.</p>
<p>The green line represents the number density of the background
community, labelled as “Resource” in the plot legend, in which our
foreground species finds itself. The green line is a straight line with
slope <code>lambda = -2.05</code>. It is important to understand that a
power-law curve looks like a straight line when plotted on logarithmic
axes and the slope of the line is the exponent in the power law. Thus
the number density is proportional to <span class="math inline">\(w^{-2.05}\)</span>.</p>
<p>The other line represents the number density of our single species,
which by default is just named unimaginatively “Target species”. We see
that it is a straight line initially, but then has a bump before
declining rapidly at large sizes. We will discuss in a short while what
causes that shape.</p>
<p>The initial slope of the species number density is negative, which
means that there are fewer larger fish than smaller fish. That is of
course understandable: some fish die while they are growing up, so there
tend to be fewer fish in larger size classes.</p>
<blockquote>
<h3 id="exercise-1">Exercise 1</h3>
<p>Now it is time for you to do the first exercise to use the commands
you have just learned about. Create a MizerParams object describing a
single species in a power-law background where the Sheldon exponent is
2.1. Assign that MizerParams object to a variable with a name other than
<code>params</code>, in order not to overwrite the MizerParams object
that we created above. Then plot the number density as a function of
weight in the steady state of that model. Once you are happy with your
plot, you can continue reading. If you need to see the solution, you can
click on the “Solution” triangle below.</p>
</blockquote>
<details><summary>
Solution
</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newSingleSpeciesParams.html">newSingleSpeciesParams</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">2.1</span><span class="op">)</span></span>
<span><span class="va">params2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/steady.html">steady</a></span><span class="op">(</span><span class="va">params2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Convergence was achieved in 1.5 years.</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">params2</span>, power <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-5-1.png" width="700"></details>
</div>
<div class="section level2">
<h2 id="numbers">Numbers<a class="anchor" aria-label="anchor" href="#numbers"></a>
</h2>
<p>While the <code><a href="../reference/plotSpectra.html">plotSpectra()</a></code> function gives us a plot of the
number density, it would be nice if we could get at the actual numbers.
The <code><a href="../reference/steady.html">steady()</a></code> function has stored those numbers as the
initial condition in the params object and we can access them with the
<code><a href="../reference/initialN-set.html">initialN()</a></code> function. Let us assign this to a variable
<code>n</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialN-set.html">initialN</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<p>As you can see in the “Environment” pane in RStudio, <code>n</code>
is a matrix with 1 row and 101 columns. The one row corresponds to the
one species. In a multispecies model there would be one row for each
species, holding the number density for that species. The 101 columns
are for the number densities in each of the 101 size classes. In fact,
<code>n</code> is a named array, i.e., each row and each column has
names. These we can extract with the <code><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames()</a></code>
function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $sp</span></span>
<span><span class="co">## [1] "Target species"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $w</span></span>
<span><span class="co">##   [1] "0.001"   "0.00112" "0.00126" "0.00141" "0.00158" "0.00178" "0.002"  </span></span>
<span><span class="co">##   [8] "0.00224" "0.00251" "0.00282" "0.00316" "0.00355" "0.00398" "0.00447"</span></span>
<span><span class="co">##  [15] "0.00501" "0.00562" "0.00631" "0.00708" "0.00794" "0.00891" "0.01"   </span></span>
<span><span class="co">##  [22] "0.0112"  "0.0126"  "0.0141"  "0.0158"  "0.0178"  "0.02"    "0.0224" </span></span>
<span><span class="co">##  [29] "0.0251"  "0.0282"  "0.0316"  "0.0355"  "0.0398"  "0.0447"  "0.0501" </span></span>
<span><span class="co">##  [36] "0.0562"  "0.0631"  "0.0708"  "0.0794"  "0.0891"  "0.1"     "0.112"  </span></span>
<span><span class="co">##  [43] "0.126"   "0.141"   "0.158"   "0.178"   "0.2"     "0.224"   "0.251"  </span></span>
<span><span class="co">##  [50] "0.282"   "0.316"   "0.355"   "0.398"   "0.447"   "0.501"   "0.562"  </span></span>
<span><span class="co">##  [57] "0.631"   "0.708"   "0.794"   "0.891"   "1"       "1.12"    "1.26"   </span></span>
<span><span class="co">##  [64] "1.41"    "1.58"    "1.78"    "2"       "2.24"    "2.51"    "2.82"   </span></span>
<span><span class="co">##  [71] "3.16"    "3.55"    "3.98"    "4.47"    "5.01"    "5.62"    "6.31"   </span></span>
<span><span class="co">##  [78] "7.08"    "7.94"    "8.91"    "10"      "11.2"    "12.6"    "14.1"   </span></span>
<span><span class="co">##  [85] "15.8"    "17.8"    "20"      "22.4"    "25.1"    "28.2"    "31.6"   </span></span>
<span><span class="co">##  [92] "35.5"    "39.8"    "44.7"    "50.1"    "56.2"    "63.1"    "70.8"   </span></span>
<span><span class="co">##  [99] "79.4"    "89.1"    "100"</span></span></code></pre>
<p>The names of the columns are the weight in grams at the start of each
size class. Notice how R displays long vectors by breaking them across
many lines and starting each line with a number in brackets. That number
is the index of the first value in that row. So for example we see that
the 61st size bracket starts at 1 gram. The number density in the size
class between 1 gram and 1.12 grams is</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">61</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.0003282314</span></span></code></pre>
<p>It is important to realise that this is not the number of fish in the
size class, but the number density. To get the number of fish we have to
multiply the number by the width of the size class. Those widths can be
obtained with the <code><a href="../reference/w.html">dw()</a></code> function. So the number of fish in
the 61st size class is</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="fu"><a href="../reference/w.html">dw</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">61</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4.005029e-05</span></span></code></pre>
<p>You may be surprised by the small number if you interpret it as the
number of fish between 1 gram and 1.12 gram in the entire ocean. However
it looks more reasonable if it is the average number per square meter of
sea. For more of a discussion of this issue of working with numbers per
area, numbers per volume or numbers for the entire system see <a href="https://sizespectrum.org/mizer/reference/setParams.html#units-in-mizer" class="uri">https://sizespectrum.org/mizer/reference/setParams.html#units-in-mizer</a></p>
<blockquote>
<h3 id="exercise-2">Exercise 2</h3>
<p>Determine the total number of fish with sizes between 10 grams and 20
grams. You can use the <code><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum()</a></code> function to add together
contributions from the various size classes.</p>
</blockquote>
<details><summary>
Solution
</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="fu"><a href="../reference/w.html">dw</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">81</span><span class="op">:</span><span class="fl">86</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4.163148e-05</span></span></code></pre>
</details>
</div>
<div class="section level2">
<h2 id="biomass-spectra">Biomass spectra<a class="anchor" aria-label="anchor" href="#biomass-spectra"></a>
</h2>
<p>Without the <code>power</code> argument (or with
<code>power = 1</code> which is the default) the
<code><a href="../reference/plotSpectra.html">plotSpectra()</a></code> function plots the biomass density as a
function of size.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Now the green line representing the biomass density of the background
has a slope of -1.05.</p>
<p>The initial slope of the species biomass density is negative, meaning
that the biomass density decreases with size. This means that even
though the individual fish of course gain biomass as they grow up, there
is so much death among the larvae and juvenile fish that the total
biomass of any cohort nevertheless decreases as it grows up. We will
explain the reason for this later when we discuss predation
mortality.</p>
<p>We can also plot the Sheldon spectrum, i.e., the biomass density as a
function of the log weight instead of the weight, by supplying the
argument <code>power = 2</code> to <code><a href="../reference/plotSpectra.html">plotSpectra()</a></code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">params</span>, power <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>This now shows an approximately constant biomass density as a
function of log size (the slope of the green line is -0.05). The biomass
density of the species as a function of log size initially increases. So
if binned in logarithmically-sized bins the biomass in each bin will
initially increase, until it starts decreasing close to the maximum size
of the species.</p>
<p>It may have been a bit confusing that we displayed the same size
spectrum in three different ways. But it is important to be aware of
this because in the literature you will see all different conventions
being used, so if you see a plot of a size spectrum you always need to
ask yourself exactly which density is being shown.</p>
<p>We can obtain the biomass density in a size class from the number
density by multiplying the number density by the weight of the
individuals in the size class. To obtain these weights, we use the
function <code><a href="../reference/w.html">w()</a></code> that returns the weights at the start of each
size class. Of course using these will lead to a discretisation error
because not all fish in the size class have the same weight, but with
the small size classes that we use in mizer, the error is not too
important. So we calculate</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biomass_density</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">*</span> <span class="fu"><a href="../reference/w.html">w</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<p>The total biomass in each size class we obtain by multiplying the
biomass density in each size class by the width of each size class</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biomass</span> <span class="op">&lt;-</span> <span class="va">biomass_density</span> <span class="op">*</span> <span class="fu"><a href="../reference/w.html">dw</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<p>For example the biomass of fish between 1 gram and 1.12 grams is</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biomass</span><span class="op">[</span><span class="fl">61</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4.005029e-05</span></span></code></pre>
<p>Next we will discuss the shape of the species size-spectrum in more
detail.</p>
</div>
<div class="section level2">
<h2 id="allometric-rates">Allometric rates<a class="anchor" aria-label="anchor" href="#allometric-rates"></a>
</h2>
<p>The first striking feature of the species size-spectrum, in all its
representations, is that for small fish (larvae and juveniles) it is
given by a straight line. This is due to the allometric scaling of the
physiological rates, which we will discuss in this section. The other
striking feature is the bulge at around maturity size, which we will
discuss in the section on reproduction.</p>
<p>First of all, the metabolic rate, i.e., the rate at which an organism
expends energy on its basic metabolic needs, scales as a power of the
organism’s body size, and the power is about <span class="math inline">\(p = 3/4\)</span>.</p>
<p>Because this energy needs to be supplied by consumption of food, it
is natural to assume that also the consumption rate scales
allometrically with a power of <span class="math inline">\(n =
3/4\)</span>. When the consumption is greater than the metabolic cost
then the excess leads to growth. Hence the growth rate too scales
allometrically with power <span class="math inline">\(n = 3/4\)</span>.
While these are standard choices for the allometric exponents, mizer
allows you to choose other values for <span class="math inline">\(p\)</span> and <span class="math inline">\(n\)</span>.</p>
<p>Finally, the death rate of organisms tends to scale allometrically
with a power of <span class="math inline">\(p - 1 = 3/4 - 1 =
-1/4\)</span>. The death rate experienced by larger individuals is
smaller than that of small individuals. Again this is confirmed by many
observations.</p>
<p>It is a result of the mathematics that if the growth and death rates
scale allometrically with exponents <span class="math inline">\(p\)</span> and <span class="math inline">\(1-p\)</span> respectively, for some metabolic
exponent <span class="math inline">\(p\)</span>, that the number density
at steady state is also a power law, i.e., a straight line on the
log-log plot.</p>
<p>Let us check that in our model the physiological rates are indeed
power laws, at least for the small sizes. We can get the growth rate
with the <code><a href="../reference/getEGrowth.html">getEGrowth()</a></code> function. We assign the result to a
variable that we name <code>growth_rate</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">growth_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getEGrowth.html">getEGrowth</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<p>You can again see in the “Environment” pane that this is a matrix
with one row for the one species and 101 columns for the 101 size
classes. So for example the growth rate at size 1 gram is</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">growth_rate</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">61</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 8.26968</span></span></code></pre>
<p>(because we had seen that the 61st size class starts at 1 gram). This
is the instantaneous per-capita growth rate, measured in grams per
year.</p>
<p>We would like to make a log-log plot of the growth rate against size
to check that it gives a straight line. We will use
<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code> for that purpose. <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code> likes to
work with data frames instead of named matrices, so we first convert the
matrix into a data frame with the <code><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt()</a></code> function.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">growth_rate_frame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">growth_rate</span><span class="op">)</span></span></code></pre></div>
<p>You can see in the “Environment” pane that the new variable that we
called <code>growth_rate_frame</code> is a data frame with 101
observations of 3 variables. The 101 observations correspond to the 101
size classes. The 3 variables have names</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">growth_rate_frame</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "sp"    "w"     "value"</span></span></code></pre>
<p>They are the species <code>sp</code>, the size <code>w</code>, and
the <code>value</code> which contains the growth_rate. This data frame
we can pass to <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">growth_rate_frame</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">w</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Weight [g]"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Growth rate [g/year]"</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>Note how we linked the x axis to the <code>w</code> variable and the
y axis to the <code>value</code> variable and specified that both axes
should be on a logarithmic scale.</p>
<p>We see that at least up to a size of a few grams the line is
straight. Let’s isolate the growth rate for those smaller sizes</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g_small_fish</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">growth_rate_frame</span>, <span class="va">w</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>and fit a linear model</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">g_small_fish</span><span class="op">$</span><span class="va">value</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">g_small_fish</span><span class="op">$</span><span class="va">w</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = log(g_small_fish$value) ~ log(g_small_fish$w))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##         (Intercept)  log(g_small_fish$w)  </span></span>
<span><span class="co">##               2.113                0.750</span></span></code></pre>
<p>The slope of the line is indeed <span class="math inline">\(0.75 =
3/4\)</span>. In fact, the above shows that for juveniles <span class="math display">\[\log(g(w)) = 2.113 + \frac34 \log(w)\]</span> and
thus <span class="math display">\[g(w) = g_0\ w^p =
2.113\  w^{3/4}.\]</span></p>
<p>Of course in a real model, the growth rate would not so exactly
follow a power law, due to variations in the growth rate due to
variations in food availability, for example.</p>
<blockquote>
<h3 id="exercise-3">Exercise 3</h3>
<p>Now over to you. Do exercise 3 in the exercise notebook. Use the
methods you have just seen to make a log-log plot of the mortality rate.
You can get the mortality rate with the <code><a href="../reference/getMort.html">getMort()</a></code> function.
While adjusting the code to this new task, you need to take into account
that the name of the size-dimension of the array returned by
<code><a href="../reference/getMort.html">getMort()</a></code> is <code>"w_prey"</code> instead of
<code>"w"</code>.</p>
</blockquote>
<details><summary>
Solution
</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mort_rate_frame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="fu"><a href="../reference/getMort.html">getMort</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mort_rate_frame</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">w_prey</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Weight [g]"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Growth rate [g/year]"</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</details><blockquote>
<p>Then fit a linear model to determine the slope and and intercept and
thus the allometric exponent and the coefficient for the mortality rate,
to establish that the mortality rate is <span class="math display">\[\mu(w) = \mu_0\ w^{p-1} = 2.038 \
w^{-1/4}.\]</span></p>
</blockquote>
<details><summary>
Solution
</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">mort_rate_frame</span><span class="op">$</span><span class="va">value</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">mort_rate_frame</span><span class="op">$</span><span class="va">w_prey</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = log(mort_rate_frame$value) ~ log(mort_rate_frame$w_prey))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                 (Intercept)  log(mort_rate_frame$w_prey)  </span></span>
<span><span class="co">##                       2.038                       -0.250</span></span></code></pre>
</details>
</div>
<div class="section level2">
<h2 id="slope-of-juvenile-spectrum">Slope of juvenile spectrum<a class="anchor" aria-label="anchor" href="#slope-of-juvenile-spectrum"></a>
</h2>
<p>We have seen that for juvenile fish the growth rate and the death
rate are both power laws with exponents <span class="math inline">\(p=3/4\)</span> and <span class="math inline">\(p-1=-1/4\)</span> respectively. By solving a
differential equation we can derive that the juvenile spectrum also
follows a power law: <span class="math display">\[N(w) = N_0\
w^{-\mu_0/g_0 - p}\]</span></p>
<p>I won’t do the maths here with you (and you probably don’t want me to
anyway), but we can check this claim numerically. Let’s look at the
spectrum up to 10 grams. By now we know how to do this. We first convert
the number density matrix <code>n</code> into a dataframe and then
filter out all observations that do not have <span class="math inline">\(w\leq 10\)</span>. The resulting data frame we
pass to <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code> and ask it to plot a line on log-log
axes.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">w</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">nf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">w</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Weight [g]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number density [1/g]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<p>That confirms what we had seen earlier, that for fish less than 10
grams the number density is a power law. To determine the exponent of
the power law we need the slope of that straight line in the log-log
plot, and the easiest way to do that is to fit a linear model to the log
variables:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">nf</span><span class="op">$</span><span class="va">value</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">nf</span><span class="op">$</span><span class="va">w</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = log(nf$value) ~ log(nf$w))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## (Intercept)    log(nf$w)  </span></span>
<span><span class="co">##      -8.022       -1.682</span></span></code></pre>
<p>The linear model fit says that the exponent is -1.682. The
mathematics claimed that the exponent should be <span class="math inline">\(-\mu_0 / g_0 - p\)</span>. We have already
observed that <span class="math inline">\(\mu_0 = 2.038\)</span> and
<span class="math inline">\(g_0 = 2.113\)</span> so we get</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">-</span><span class="va">m0</span> <span class="op">/</span> <span class="va">g0</span> <span class="op">-</span> <span class="fl">3</span><span class="op">/</span><span class="fl">4</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -1.714505</span></span></code></pre>
<p>That is not quite the result of the linear model fit, but that is the
nature of numerical calculations: one gets discretisation errors and
rounding errors.</p>
</div>
<div class="section level2">
<h2 id="shape-of-adult-spectrum">Shape of adult spectrum<a class="anchor" aria-label="anchor" href="#shape-of-adult-spectrum"></a>
</h2>
<p>Now that we understand the shape of the size spectrum for the
juvenile fish, let us try to understand the bulge that follows. The
increase of abundance that we see at around the maturity size of our
species is due to a drop in growth rate at that size. This in turn is
due to the fact that the mature fish invests some of its energy income
into reproduction.</p>
<div class="section level3">
<h3 id="investment-into-reproduction">Investment into reproduction<a class="anchor" aria-label="anchor" href="#investment-into-reproduction"></a>
</h3>
<p>Let us look at a plot of the proportion of the available energy that
is invested into reproduction as a function of the size</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="fu"><a href="../reference/setReproduction.html">getMaturityProportion</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="../reference/setReproduction.html">getReproductionProportion</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">psi</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">w</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Weight [g]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Proportion invested into reproduction"</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<p>How was this maturity curve specified? You can find the details in
the <a href="https://sizespectrum.org/mizer/reference/setReproduction.html#investment">mizer
documentation</a>. There are four species parameters involved:</p>
<ul>
<li>the maturity size <code>w_mat</code> at which 50% of the individuals
are mature.</li>
<li>the size <code>w_mat25</code> at which 25% of the individuals are
mature.</li>
<li>the asymptotic size <code>w_inf</code> at which an organism invests
100% of its income into reproduction and thus growth is zero.</li>
<li>an exponent <code>m</code> that determines how the proportion that
an individual invests into reproduction scales with its size.</li>
</ul>
<p>Such species parameters are contained in a data frame inside the
<code>params</code> object that we can access with the
<code><a href="../reference/species_params.html">species_params()</a></code> function.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                       species w_min w_inf    w_mat w_min_idx k_vb    gamma</span></span>
<span><span class="co">## Target species Target species 0.001   100 25.11886         1    1 4067.903</span></span>
<span><span class="co">##                      ks  f0   fc beta sigma z0 alpha   erepro</span></span>
<span><span class="co">## Target species 5.906914 0.6 0.25  100   1.3  0   0.4 0.899483</span></span>
<span><span class="co">##                interaction_resource    n    p   q pred_kernel_type        h k</span></span>
<span><span class="co">## Target species                    1 0.75 0.75 0.8        lognormal 59.06914 0</span></span>
<span><span class="co">##                 w_mat25 m R_max</span></span>
<span><span class="co">## Target species 22.50546 1   Inf</span></span></code></pre>
<p>As you can see, there are a lot of other species parameters, some of
which we will talk about later. For now let’s just select the 4
parameters we are interested in.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>, <span class="va">w_mat</span>, <span class="va">w_mat25</span>, <span class="va">w_inf</span>, <span class="va">m</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   w_mat  w_mat25 w_inf m</span></span>
<span><span class="co">## Target species 25.11886 22.50546   100 1</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="effect-of-change-in-maturity-curve">Effect of change in maturity curve<a class="anchor" aria-label="anchor" href="#effect-of-change-in-maturity-curve"></a>
</h3>
<p>Let us investigate what happens when we change the maturity curve.
Let’s assume the maturity size is actually 40 grams and the size at
which 25% of individuals is mature is 30 grams. Let us change the values
in the <code>species_params</code> data frame. But first we make a copy
of the params object so that we can keep the old version around
unchanged.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_changed_maturity</span> <span class="op">&lt;-</span> <span class="va">params</span></span></code></pre></div>
<p>In this copy we now change the species parameters</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params_changed_maturity</span><span class="op">)</span><span class="op">$</span><span class="va">w_mat</span> <span class="op">&lt;-</span> <span class="fl">40</span></span>
<span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params_changed_maturity</span><span class="op">)</span><span class="op">$</span><span class="va">w_mat25</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">params_changed_maturity</span><span class="op">@</span><span class="va">species_params</span>, <span class="va">w_mat</span>, <span class="va">w_mat25</span>, <span class="va">w_inf</span>, <span class="va">m</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                w_mat w_mat25 w_inf m</span></span>
<span><span class="co">## Target species    40      30   100 1</span></span></code></pre>
<p>Now the maturity curve has changed, which we can verify by plotting
it</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">psi_changed_maturity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="fu"><a href="../reference/setReproduction.html">getMaturityProportion</a></span><span class="op">(</span><span class="va">params_changed_maturity</span><span class="op">)</span> <span class="op">*</span> </span>
<span>                               <span class="fu"><a href="../reference/setReproduction.html">getReproductionProportion</a></span><span class="op">(</span><span class="va">params_changed_maturity</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">psi_changed_maturity</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">w</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Weight [g]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Proportion invested into reproduction"</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
<p>At this point let’s take a little break and learn how to draw two
curves in the same graph. How can we see the old maturity curve and the
new maturity curve in the same plot? First we add an extra column to
each dataframe describing it</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">psi</span><span class="op">$</span><span class="va">type</span> <span class="op">=</span> <span class="st">"original"</span></span>
<span><span class="va">psi_changed_maturity</span><span class="op">$</span><span class="va">type</span> <span class="op">=</span> <span class="st">"changed"</span></span></code></pre></div>
<p>Then we bind the two data frames together</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">psi_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">psi</span>, <span class="va">psi_changed_maturity</span><span class="op">)</span></span></code></pre></div>
<p>and send that combined data frame to <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code></p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">psi_combined</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">w</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Weight [g]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Proportion invested into reproduction"</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-39-1.png" width="700"></p>
<p>This change in the maturity curve of course implies a change in the
growth rates.</p>
<blockquote>
<h3 id="exercise-4">Exercise 4</h3>
<p>Make a plot showing the growth rates of the original model and of the
model with the changed maturity curve.</p>
</blockquote>
<details><summary>
Solution
</summary><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">growth_rate_frame_changed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="fu"><a href="../reference/getEGrowth.html">getEGrowth</a></span><span class="op">(</span><span class="va">params_changed_maturity</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">growth_rate_frame</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"original"</span></span>
<span><span class="va">growth_rate_frame_changed</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"changed"</span></span>
<span><span class="va">growth_rate_frame_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">growth_rate_frame</span>,</span>
<span>                                    <span class="va">growth_rate_frame_changed</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">growth_rate_frame_combined</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">w</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Weight [g]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Growth rate [g/year]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-40-1.png" width="700"></p>
</details><p>Next let us look at how the steady state spectrum has changed. We
first need to run the changed model to steady state</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_changed_maturity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/steady.html">steady</a></span><span class="op">(</span><span class="va">params_changed_maturity</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Convergence was achieved in 6 years.</span></span></code></pre>
<p>We use the same technique as above to plot the steady-state spectra
of both models on top of each other.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="fu"><a href="../reference/initialN-set.html">initialN</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nf_changed_maturity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="fu"><a href="../reference/initialN-set.html">initialN</a></span><span class="op">(</span><span class="va">params_changed_maturity</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nf</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"original"</span></span>
<span><span class="va">nf_changed_maturity</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"changed"</span></span>
<span><span class="va">nf_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">nf</span>, <span class="va">nf_changed_maturity</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">nf_combined</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">w</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Weight [g]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number density [1/g]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-42-1.png" width="700"></p>
<p>As expected, the bump happens later due to the larger maturity size
and it is less pronounced, because the maturity curve is less steep.</p>
</div>
<div class="section level3">
<h3 id="reproductive-efficiency">Reproductive efficiency<a class="anchor" aria-label="anchor" href="#reproductive-efficiency"></a>
</h3>
<p>So what happens with the energy that is invested into reproduction?
It leads to spawning and thus the influx of new individuals at the egg
size. This conversion of energy invested into reproduction into egg
biomass is inefficient. Firstly much energy is spent on things like
migration to spawning grounds, rather than on production of gonadic
mass. Secondly, only a small proportion of eggs that are produced are
viable and hatch into larvae.</p>
<p>In order for the population to be at steady state, the reproductive
efficiency has to have a particular value. If it were higher, the
population would increase, if it was lower, the population would
decrease with time. The <code><a href="../reference/steady.html">steady()</a></code> function has set the
reproductive efficiency to just the right value to maintain the
population level and has stored it in the species parameter called
<code>erepro</code>.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">$</span><span class="va">erepro</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.899483</span></span></code></pre>
<p>The model with the changed maturity curve leads to a different rate
of investment into reproduction and thus needs a slightly different
reproductive efficiency to remain at steady state:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params_changed_maturity</span><span class="op">)</span><span class="op">$</span><span class="va">erepro</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.8894015</span></span></code></pre>
<p>This is the reproductive efficiency at steady state. When the
population deviates from the steady state, for example due to a change
in fishing, the reproductive efficiency can be set to change according
to a Beverton-Holt stock-recruitment curve. We will discuss this again
later.</p>
</div>
</div>
<div class="section level2">
<h2 id="predation">Predation<a class="anchor" aria-label="anchor" href="#predation"></a>
</h2>
<p>It is now time to discuss the important issue of predation. It is
through predation that the fish obtains the energy it needs to maintain
its metabolism, to grow and to invest in reproduction. So it is
important how we model this predation.</p>
<div class="section level3">
<h3 id="effect-of-prey-availability">Effect of prey availability<a class="anchor" aria-label="anchor" href="#effect-of-prey-availability"></a>
</h3>
<p>The energy income for a fish comes from predation on its prey. If
there is less prey, the fish consumes less and thus its growth rate will
decrease. Let us investigate this by artificially removing some
prey.</p>
<p>Below we decrease the community spectrum by a factor of 10 in the
size range from 1mg to 10mg. We again create a new parameter object to
be able to keep the old one around</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_starved</span> <span class="op">&lt;-</span> <span class="va">params</span></span>
<span><span class="va">size_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/w.html">w_full</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">3</span> <span class="op">&amp;</span> <span class="fu"><a href="../reference/w.html">w_full</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span></span>
<span><span class="fu"><a href="../reference/initialNResource-set.html">initialNResource</a></span><span class="op">(</span><span class="va">params_starved</span><span class="op">)</span><span class="op">[</span><span class="va">size_range</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/initialNResource-set.html">initialNResource</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">[</span><span class="va">size_range</span><span class="op">]</span> <span class="op">/</span> <span class="fl">10</span></span></code></pre></div>
<p>That is of course quite a dramatic intervention, and so should allow
us to clearly see its effect on the steady-state size distribution of
our species.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_starved</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/steady.html">steady</a></span><span class="op">(</span><span class="va">params_starved</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Convergence was achieved in 6 years.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in setBevertonHolt(params, reproduction_level = old_reproduction_level):</span></span>
<span><span class="co">## The following species require an unrealistic reproductive efficiency greater</span></span>
<span><span class="co">## than 1: Target species</span></span></code></pre>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">params_starved</span>, power <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-47-1.png" width="700"></p>
<p>As expected, the lack of food and the resulting slow-down in growth
leads to a traffic jam: a peak in the biomass density. This slow-down
occurs at a size that is about a factor of 100 larger than the size at
which food is reduced. Why this is we will discuss in the next section.
But first investigate what happens when the prey abundance is increased
instead of decreased.</p>
<blockquote>
<h3 id="exercise-5">Exercise 5</h3>
<p>Plot the steady state biomass density in our model when the community
abundance is increased by a factor of 10 in the size range from 1mg to
10mg.</p>
</blockquote>
<details><summary>
Solution
</summary><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_overfed</span> <span class="op">&lt;-</span> <span class="va">params</span></span>
<span><span class="va">size_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/w.html">w_full</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">3</span> <span class="op">&amp;</span> <span class="fu"><a href="../reference/w.html">w_full</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span></span>
<span><span class="fu"><a href="../reference/initialNResource-set.html">initialNResource</a></span><span class="op">(</span><span class="va">params_overfed</span><span class="op">)</span><span class="op">[</span><span class="va">size_range</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/initialNResource-set.html">initialNResource</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">[</span><span class="va">size_range</span><span class="op">]</span> <span class="op">*</span> <span class="fl">10</span></span>
<span><span class="va">params_overfed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/steady.html">steady</a></span><span class="op">(</span><span class="va">params_overfed</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Convergence was achieved in 4.5 years.</span></span></code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">params_overfed</span>, power <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-48-1.png" width="700"></details>
</div>
<div class="section level3">
<h3 id="how-predation-is-modelled">How predation is modelled<a class="anchor" aria-label="anchor" href="#how-predation-is-modelled"></a>
</h3>
<p>The easiest case in which to understand predation is to imagine a
filter feeding fish, swimming around with its mouth open. Clearly the
amount of food it takes in is determined by four things:</p>
<ul>
<li>the density of prey in the water,</li>
<li>how much volume of water the fish is able to filter, which will
depend on how fast it swims as well as on its gape size.</li>
<li>what sizes of prey the fish is able to filter out of the water,
which will be limited by its gape size and by how fine its gill rakers
are,</li>
<li>how fast it can digest the food. If it can filter the prey faster
than it can digest, it will have to start letting prey go uneaten.</li>
</ul>
<p>For a more active hunter the situation will be similar. The rate at
which it predates will depend on four things:</p>
<ul>
<li>the density of prey in the water</li>
<li>the volume of water that the fish patrols and in which it will be
able to seek out its prey. This may depend on things like radius of
vision.</li>
<li>which of this detected prey the fish is able to catch, which will
depend on its mouth size but also on its agility and skill as well as on
the defensive mechanisms of the prey.</li>
<li>how fast it can digest the food.</li>
</ul>
<p>Of these four factors, we have of course already been discussing the
density of prey. In the next section we will discuss the ability to
filter out or catch prey of particular sizes, which we model via the
predation kernel. In the section after that we will discuss the search
volume and then in the following section the maximum consumption
rate.</p>
</div>
<div class="section level3">
<h3 id="the-predation-kernel">The predation kernel<a class="anchor" aria-label="anchor" href="#the-predation-kernel"></a>
</h3>
<p>Fish will be particularly good at catching prey in a specific range
of sizes, smaller than themselves. This is encoded in the size-spectrum
model by the predation kernel. Let us take a look at the predation
kernel in our model. We can obtain it with the function
<code><a href="../reference/setPredKernel.html">getPredKernel()</a></code>.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_kernel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setPredKernel.html">getPredKernel</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<p>This is a large three-dimensional array (predator species x predator
size x prey size). We extract the kernel of a predator of size 10g
(using that we remember that this is in size class 81)</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_kernel_10</span> <span class="op">&lt;-</span> <span class="va">pred_kernel</span><span class="op">[</span>, <span class="fl">81</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span></code></pre></div>
<p>The <code>drop = FALSE</code> option is there to prevent R from
dropping any of the array dimensions. We can now plot this as usual</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">pred_kernel_10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">w_prey</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-51-1.png" width="700"></p>
<p>We see that the predator of size 10g likes to feed on prey that is
about a factor 100 smaller than itself, but also feeds on other sizes,
just with reduced preference. The preferred predator/prey size ratio is
determined by the species parameter <code>beta</code> and the width of
the feeding kernel, i.e., how fussy the predator is regarding their prey
size, is determined by the species parameter <code>sigma</code>. In our
model these have the values</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>, <span class="va">beta</span>, <span class="va">sigma</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                beta sigma</span></span>
<span><span class="co">## Target species  100   1.3</span></span></code></pre>
<p>Let us change the preferred predator/prey mass ratio from 100 to
1000. As usual, we first create a copy of the parameter object, then we
make the change in that copy.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_pk</span> <span class="op">&lt;-</span> <span class="va">params</span></span>
<span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params_pk</span><span class="op">)</span><span class="op">$</span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></code></pre></div>
<p>Let’s make a plot to see that the predation kernel has indeed
changed.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/setPredKernel.html">getPredKernel</a></span><span class="op">(</span><span class="va">params_pk</span><span class="op">)</span><span class="op">[</span>, <span class="fl">81</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">w_prey</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-54-1.png" width="700"></p>
<p>If we now again reduce the prey in the size range from 1mg to 10mg as
before, we now expect this to produce a peak in the biomass spectrum
somewhere between 1g and 10g. Let’s check.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/initialNResource-set.html">initialNResource</a></span><span class="op">(</span><span class="va">params_pk</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialNResource-set.html">initialNResource</a></span><span class="op">(</span><span class="va">params_starved</span><span class="op">)</span></span>
<span><span class="va">params_pk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/steady.html">steady</a></span><span class="op">(</span><span class="va">params_pk</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Convergence was achieved in 4.5 years.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in setBevertonHolt(params, reproduction_level = old_reproduction_level):</span></span>
<span><span class="co">## The following species require an unrealistic reproductive efficiency greater</span></span>
<span><span class="co">## than 1: Target species</span></span></code></pre>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">params_pk</span>, power <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-55-1.png" width="700"></p>
<p>Yes, as expected.</p>
<p>For details of how <code>beta</code> and <code>sigma</code>
parametrise the predation kernel, see <a href="https://sizespectrum.org/mizer/reference/lognormal_pred_kernel.html#details" class="uri">https://sizespectrum.org/mizer/reference/lognormal_pred_kernel.html#details</a>.
For information on how to change the predation kernel, see <a href="https://sizespectrum.org/mizer/reference/setPredKernel.html#setting-predation-kernel" class="uri">https://sizespectrum.org/mizer/reference/setPredKernel.html#setting-predation-kernel</a></p>
<p>It is very important not to confuse the prey preference with the
diet. Just because a predator might prefer to feed on prey of a
particular size if it had free choice does not mean that it actually
feeds predominantly on such prey. The actual diet of the fish depends
also on the availability of prey. Because smaller prey are more
abundant, the realised predator/prey mass ratio in the diet will be
smaller than the preferred predator/prey mass ratio. This is
particularly important when estimating the predation kernel from stomach
data.</p>
<blockquote>
<h3 id="exercise-6">Exercise 6</h3>
<p>Change the parameters of the predation kernel to
<code>beta = 50</code> and <code>sigma = 2</code> and plot the predation
kernel of a predator of size 1g. You should see that the predation
kernel is truncated so that the predator never feeds on prey larger than
themselves.</p>
</blockquote>
<details><summary>
Solution
</summary><div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params3</span> <span class="op">&lt;-</span> <span class="va">params</span></span>
<span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params3</span><span class="op">)</span><span class="op">$</span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params3</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="fu"><a href="../reference/setPredKernel.html">getPredKernel</a></span><span class="op">(</span><span class="va">params3</span><span class="op">)</span><span class="op">[</span>, <span class="fl">61</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">w_prey</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-56-1.png" width="700"></p>
</details><blockquote>
<p>Next, plot the steady state arising with this feeding kernel when the
prey abundance is artificially reduced by a factor of 10 in the size
range between 1mg and 10mg as in previous examples. What do you observe?
Are you surprised?</p>
</blockquote>
<details><summary>
Solution
</summary><div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/initialNResource-set.html">initialNResource</a></span><span class="op">(</span><span class="va">params3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialNResource-set.html">initialNResource</a></span><span class="op">(</span><span class="va">params_starved</span><span class="op">)</span></span>
<span><span class="va">params3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/steady.html">steady</a></span><span class="op">(</span><span class="va">params3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Convergence was achieved in 4.5 years.</span></span></code></pre>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">params3</span>, power <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-57-1.png" width="700">
There is no pronounced bump created this time. This is because the
larvae experience a decreased growth rate already almost from the start
of their life. So th
</details>
</div>
<div class="section level3">
<h3 id="search-volume">Search volume<a class="anchor" aria-label="anchor" href="#search-volume"></a>
</h3>
<p>Next we consider the factor that models the volume of water a filter
feeder is able to filter in a certain amount of time, or the volume of
water a forage fish is able to patrol in a certain amount of time. This
is difficult to model from first principles, although people have tried
to argue in terms of swimming speeds of fish. We assume that this search
volume rate is also an allometric rate. Let <span class="math inline">\(\gamma(w)\)</span> denote this rate for a predator
of size <span class="math inline">\(w\)</span>. Thus we assume that
<span class="math display">\[\gamma(w) = \gamma_0\ w^q\]</span> for some
exponent <span class="math inline">\(q\)</span>. We know that a fish
needs to consume prey at a rate that scales with its body size to the
power <span class="math inline">\(p\)</span>, with <span class="math inline">\(p\)</span> about <span class="math inline">\(3/4\)</span>. We also know that the prey density
will be approximately described by the Sheldon power law, i.e., that
<span class="math inline">\(N(w) = N_0\ w^{-\lambda}\)</span>. A bit of
maths then says that <span class="math display">\[q = 2 - \lambda +
n.\]</span> This explains the message you got when you created the
params object with a certain choice of <span class="math inline">\(\lambda\)</span>: mizer chose the search volume
exponent automatically according to this formula. In the real world,
evolution will have made sure that the fish will have developed a
feeding strategy that allows it to cover its metabolic costs, and thus
leads to that search volume exponent of <span class="math inline">\(q\)</span>. Clearly, filter feeders have taken a
very different route to this than forage fish, but the result is the
same.</p>
<p>Let us see what effect changing the coefficient <span class="math inline">\(\gamma_0\)</span> in the search volume rate has.
Its current value in our model is</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">$</span><span class="va">gamma</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4067.903</span></span></code></pre>
<p>We change that to 2000 and find the new steady state.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_new_gamma</span> <span class="op">&lt;-</span> <span class="va">params</span></span>
<span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params_new_gamma</span><span class="op">)</span><span class="op">$</span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span><span class="va">params_new_gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/steady.html">steady</a></span><span class="op">(</span><span class="va">params_new_gamma</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in setBevertonHolt(params, reproduction_level = old_reproduction_level):</span></span>
<span><span class="co">## The following species require an unrealistic reproductive efficiency greater</span></span>
<span><span class="co">## than 1: Target species</span></span></code></pre>
<p>We can see the effect in the growth curve of our species. In the
original model it looks as follows:</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotGrowthCurves.html">plotGrowthCurves</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-60-1.png" width="700"></p>
<p>In the modified model it looks like</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotGrowthCurves.html">plotGrowthCurves</a></span><span class="op">(</span><span class="va">params_new_gamma</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-61-1.png" width="700"></p>
<blockquote>
<h3 id="exercise-7">Exercise 7</h3>
<p>What effect will this change in growth rate have on the slope of the
juvenile spectrum? Will it be steeper or shallower? Make the plot of the
spectrum to see.</p>
</blockquote>
<details><summary>
Solution
</summary><p>The juvenile spectrum will be steeper because the slope is <span class="math inline">\(-\mu_0/g_0 - p\)</span> and for smaller growth
rate coefficient <span class="math inline">\(g_0\)</span> this will be
more negative.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="fu"><a href="../reference/initialN-set.html">initialN</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nf_new_gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="fu"><a href="../reference/initialN-set.html">initialN</a></span><span class="op">(</span><span class="va">params_new_gamma</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nf</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"original"</span></span>
<span><span class="va">nf_new_gamma</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"changed"</span></span>
<span><span class="va">nf_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">nf</span>, <span class="va">nf_new_gamma</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">nf_combined</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">w</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Weight [g]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number density [1/g]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-62-1.png" width="700"></p>
</details>
</div>
<div class="section level3">
<h3 id="feeding-level">Feeding level<a class="anchor" aria-label="anchor" href="#feeding-level"></a>
</h3>
<p>A predator will have a maximum intake rate. It will simply not be
able to utilise food at a faster rate than its maximum intake rate. Of
course in practice it will not feed at the maximum intake rate because
of limited availability of prey. We describe this by the <em>feeding
level</em> which is the proportion of its maximum intake rate at which
the predator is actually taking in prey.</p>
<p>In our simple model this feeding level is constant.</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotFeedingLevel.html">plotFeedingLevel</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-63-1.png" width="700"></p>
<p>In the model with the reduced search volume the feeding level will be
lower</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotFeedingLevel.html">plotFeedingLevel</a></span><span class="op">(</span><span class="va">params_new_gamma</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-64-1.png" width="700"></p>
<p>Our model is taking an allometric form for the maximum intake rate
<span class="math inline">\(h(w)\)</span> as a function of predator size
<span class="math inline">\(w\)</span>: <span class="math inline">\(h(w)
= h\ w^n\)</span>. The current value of the coefficient <span class="math inline">\(h\)</span> is</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">$</span><span class="va">h</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 59.06914</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="mortality">Mortality<a class="anchor" aria-label="anchor" href="#mortality"></a>
</h2>
<div class="section level3">
<h3 id="predation-mortality">Predation mortality<a class="anchor" aria-label="anchor" href="#predation-mortality"></a>
</h3>
<p>Of course growth of the predator is only one aspect of predation. The
other is the death of the prey. Growth and mortality are coupled.
Increased growth of one class of individuals will necessitate increased
death of another. There is no free lunch.</p>
<p>Once we have specified the predation parameters, these parameters
determine both the growth of predators but also the mortality rate of
prey. So we don’t have to introduce new parameters for death from
predation.</p>
</div>
<div class="section level3">
<h3 id="external-mortality">External mortality<a class="anchor" aria-label="anchor" href="#external-mortality"></a>
</h3>
<p>In addition to mortality caused by predation from other fish, there
will be some mortality from other causes. This could be predation from
animals that we have not included in our model, like sea birds or
mammals, or it could be death from old age (senescent death) or disease.
Mizer allows setting of background death with
<code><a href="../reference/setExtMort.html">setExtMort()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="fishing-mortality">Fishing mortality<a class="anchor" aria-label="anchor" href="#fishing-mortality"></a>
</h3>
<p>The cause of mortality that is most under our control is mortality
from fishing. You can see how fishing is set up in mizer at <a href="https://sizespectrum.org/mizer/reference/setFishing.html#setting-fishing" class="uri">https://sizespectrum.org/mizer/reference/setFishing.html#setting-fishing</a>.
Here we only look at a simple example: we introduce fishing on our
species only for fish above 30 grams. All fish greater than 30 grams
will be exposed to the same fishing mortality. We call this kind of
fishing selectivity “knife_edge” selectivity. Mizer can deal with more
general selectivity curves, like sigmoidal or doubly sigmoidal.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_fishing</span> <span class="op">&lt;-</span> <span class="va">params</span></span>
<span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params_fishing</span><span class="op">)</span><span class="op">$</span><span class="va">sel_func</span> <span class="op">&lt;-</span> <span class="st">"knife_edge"</span></span>
<span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params_fishing</span><span class="op">)</span><span class="op">$</span><span class="va">knife_edge_size</span> <span class="op">&lt;-</span> <span class="fl">30</span></span></code></pre></div>
<p>We also need to specify the fishing effort and can then plot the
resulting fishing mortality.</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_fishing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setFishing.html">setFishing</a></span><span class="op">(</span><span class="va">params_fishing</span>, initial_effort <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotFMort.html">plotFMort</a></span><span class="op">(</span><span class="va">params_fishing</span><span class="op">)</span></span></code></pre></div>
<p><img src="single_species_size-spectrum_dynamics_files/figure-html/unnamed-chunk-67-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="reproduction">Reproduction<a class="anchor" aria-label="anchor" href="#reproduction"></a>
</h2>
</div>
<div class="section level2">
<h2 id="outlook">Outlook<a class="anchor" aria-label="anchor" href="#outlook"></a>
</h2>
<p>The fish species we have studied had unlimited food and constant
mortality. That of course is very unrealistic. In reality, food will
become scarce when the fish population increases too much. Also the
number of predators will grow. This will lead to interesting and
important non-linear effects that we will study in the next
tutorial.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.york.ac.uk/maths/staff/gustav-delius/" class="external-link">Gustav Delius</a>, Finlay Scott, <a href="http://www.utas.edu.au/profiles/staff/imas/julia-blanchard" class="external-link">Julia Blanchard</a>, <a href="https://ken.haste.dk/" class="external-link">Ken Andersen</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
