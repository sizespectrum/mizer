<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The Community Model • mizer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The Community Model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mizer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.5.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/mizer.html">Get started</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mizer.course.sizespectrum.org">Course</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/model_description.html">The General Mizer Size-spectrum Model</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/single_species_size-spectrum_dynamics.html">Single-species size-spectrum dynamics</a></li>
    <li><a class="dropdown-item" href="../articles/community_model.html">The Community Model</a></li>
    <li><a class="dropdown-item" href="../articles/trait_model.html">The Trait-Based Model</a></li>
    <li><a class="dropdown-item" href="../articles/multispecies_model.html">The Multi Species Model</a></li>
    <li><a class="dropdown-item" href="../articles/running_a_simulation.html">Running a Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/exploring_the_simulation_results.html">Exploring the Simulation Results</a></li>
    <li><a class="dropdown-item" href="../articles/a_multispecies_model_of_the_north_sea.html">A Multi-Species Model of the North Sea</a></li>
    <li><a class="dropdown-item" href="../articles/plotting.html">Using ggplot2 and plotly with mizer</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Publications</h6></li>
    <li><a class="dropdown-item" href="../articles/publications.html">Publications</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>For developers</h6></li>
    <li><a class="dropdown-item" href="../articles/developer_vignette.html">Developer Guide</a></li>
    <li><a class="dropdown-item" href="../articles/working_with_git.html">Working with git and GitHub</a></li>
    <li><a class="dropdown-item" href="../articles/developer_FAQ.html">Developer FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/editing_website.html">Editing the Mizer Website</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://blog.mizer.sizespectrum.org">Blog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/mizer_model" aria-label="Twitter"><span class="fa fab fa-twitter fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sizespectrum/mizer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>The Community Model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sizespectrum/mizer/blob/v2.5.3/vignettes/community_model.Rmd" class="external-link"><code>vignettes/community_model.Rmd</code></a></small>
      <div class="d-none name"><code>community_model.Rmd</code></div>
    </div>

    
    
<p>The simplest version of the size spectrum model is the community
model. In the community model, individuals are only characterized by
their size and are represented by a single group representing an
across-species aggregate. Reproduction is not considered; the
reproduction rate <span class="math inline">\(R\)</span> is set to be
constant. The resource spectrum only extends to the start of the
community spectrum. Metabolism is turned off.</p>
<p>In this section we describe how a community model can be set up and
projected through time. We then use a community model to illustrate the
idea of a trophic cascade. Due to the relative simplicity of this type
of model, it is useful for gently introducing some of the concepts
behind the mizer package. Consequently, this section should hopefully
serve as an introduction to using mizer.</p>
<div class="section level2">
<h2 id="sec:set_up_comm_model">Setting up a community model<a class="anchor" aria-label="anchor" href="#sec:set_up_comm_model"></a>
</h2>
<p>The first stage in implementing a model using <code>mizer</code> is
to create an object of class <code>MizerParams</code>. This class
contains the model parameters including the life-history parameters of
the species in the model, the fishing selectivity functions and the
parameters of the resource spectrum.</p>
<p>To avoid having to make a <code>MizerParams</code> object directly,
the <code><a href="../reference/newCommunityParams.html">newCommunityParams()</a></code> wrapper function, has been
provided that conveniently creates a <code>MizerParams</code> object
specifically for a community model. The documentation for the function
can be seen by clicking on the function name anywhere it appears on this
page: <code><a href="../reference/newCommunityParams.html">newCommunityParams()</a></code>.</p>
<p>As can be seen in the help page, the function can take many
arguments. We can ignore most of these for the moment as they almost all
come with default values.</p>
<p>The arguments that you should pay attention to are: <code>z0</code>
(the external mortality rate), <code>alpha</code> (the assimilation
efficiency of the community), <code>f0</code> (the average feeding level
of the community, which is used to calculate <span class="math inline">\(\gamma\)</span>) and <code>h</code> (the
coefficient of the maximum intake rate).</p>
<p>Although default values for these parameters are provided, you are
encouraged to explore how changing the values affects the simulated
community. For example, the default value of <code>z0</code> is <span class="math inline">\(0.1\)</span>. Increasing this value effectively
‘shortens’ the length of the community spectrum.</p>
<p>The <code><a href="../reference/newCommunityParams.html">newCommunityParams()</a></code> function is called by passing
in the arguments by name. Any parameter that is not passed in is set to
the default value. For example, the following line sets up the
parameters with <code>z0</code> = 0.05, <code>f0</code> = 0.5. All other
parameters will have their default value:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommunityParams.html">newCommunityParams</a></span><span class="op">(</span>z0 <span class="op">=</span> <span class="fl">0.05</span>, f0 <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p>Calling the function creates and returns an object of type
<code>MizerParams</code>. We can check this using the
<code><a href="https://rdrr.io/r/base/class.html" class="external-link">class()</a></code> function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "MizerParams"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "mizer"</span></span></code></pre>
<p>To work with mizer you do not have to worry about how this object is
realised internally. All you need to know is that it contains all the
information needed to run model simulations and that mizer provides you
with functions to access, use and modify this information.</p>
<p>A very brief description of the model contained in the MizerParams
object can be seen by calling the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method on
it:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class "MizerParams" </span></span>
<span><span class="co">## Consumer size spectrum:</span></span>
<span><span class="co">##  minimum size:   0.001</span></span>
<span><span class="co">##  maximum size:   1e+06</span></span>
<span><span class="co">##  no. size bins:  100</span></span>
<span><span class="co">## Resource size spectrum:</span></span>
<span><span class="co">##  minimum size:   8.11131e-11</span></span>
<span><span class="co">##  maximum size:   0.000811131</span></span>
<span><span class="co">##  no. size bins:  78  (178 size bins in total)</span></span>
<span><span class="co">## Species details:</span></span>
<span><span class="co">##     species w_max  w_mat w_min  f0 beta sigma</span></span>
<span><span class="co">## 1 Community 1e+06 250000 0.001 0.5  100     2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Fishing gear details:</span></span>
<span><span class="co">## Gear          Effort  Target species </span></span>
<span><span class="co">##  ----------------------------------</span></span>
<span><span class="co">## Community      0.00   Community</span></span></code></pre>
<p>In the summary you can see that the size range of the community
spectrum has been set from <span class="math inline">\(0.001\)</span> to
<span class="math inline">\(10^{6}\)</span> and this is divided into
<span class="math inline">\(100\)</span> size bins. Similar information
is available for the resource spectrum. Additionally, the community is
made up of only one species, called <em>Community</em>, which has an
maximum size of <span class="math inline">\(10^{6}\)</span> and a
preferred predator prey mass ratio of <span class="math inline">\(100\)</span>. The <code>w_mat</code> parameter has
been set to <code>NA</code> as it is not used when running a community
model. These values have all been set by default using the
<code><a href="../reference/newCommunityParams.html">newCommunityParams()</a></code> function.</p>
</div>
<div class="section level2">
<h2 id="sec:running_comm_model">Running the community model<a class="anchor" aria-label="anchor" href="#sec:running_comm_model"></a>
</h2>
<p>The <code><a href="../reference/newCommunityParams.html">newCommunityParams()</a></code> function has given us a
<code>MizerParams</code> object that contains all the information mizer
needs about the model community. We can use this to perform a simulation
and project the community through time. In the <code>mizer</code>
package, projections are performed using the <code><a href="../reference/project.html">project()</a></code>
function. You can see the help page for <code><a href="../reference/project.html">project()</a></code> for more
details and it is described fully in <a href="running_a_simulation.html">the section on running a
simulation.</a> We will ignore the details for the moment and just use
<code><a href="../reference/project.html">project()</a></code> to run some simple projections. The arguments for
<code><a href="../reference/project.html">project()</a></code> that we need to be concerned with are
<code>effort</code>, which determines the fishing effort (and therefore
fishing mortality) through time, and <code>t_max</code>, which is the
number of years we want to project into the future. Initial population
abundances have been set automatically (by the
<code><a href="../reference/get_initial_n.html">get_initial_n()</a></code> function). It is possible to set your own
initial abundances but we will not do this here.</p>
<p>To run a projection for 50 years, with no fishing effort (i.e. we
want to model an unexploited community) we run:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span><span class="va">params</span>, t_max <span class="op">=</span> <span class="fl">50</span>, effort <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>The resulting object, <code>sim</code>, is of type
<code>MizerSim</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "MizerSim"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "mizer"</span></span></code></pre>
<p>This class holds the results of the simulation, including the
community and resource abundances at size through time, as well as the
original model parameters. It is explained in detail in <a href="running_a_simulation.html">the section on running a
simulation.</a></p>
<p>After running the projection, it is possible to explore the results
using a range of plots and analyses. These are described fully in <a href="exploring_the_simulation_results.html">the section on exploring
the simulation results.</a></p>
<p>To quickly look at the results of the projection you can call the
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method. This plots the feeding level, predation
mortality, fishing mortality and abundance by size in the last time step
of the simulation, and the total biomass through time. Each of the plots
can be shown individually if desired.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<p><img src="community_model_files/figure-html/print_plot_comm_sim-1.png" alt="The plot shows the results of the community model projection. The top panel shows the total biomass of the community through time. The other panels show the feeding level, predation mortality, fishing mortality and abundance by size in the last time step of the simulation." width="700"></p>
<p>In the above plot there are several things going on that are worth
talking about. Looking at the total biomass of the community against
time, you can see that the biomass quickly reaches a stable equilibrium.
The other panels show what is happening at the last time step in the
simulation, which in this case is when the community is at equilibrium.
Fishing mortality is 0 because we set the <code>effort</code> argument
to 0 when running the simulation. The predation mortality rate is
clearly a function of size, with the smallest sizes experiencing the
highest levels of predation. The feeding level describes how satiated an
individual is, with 0 being unfed, and 1 being full satiated. The
feeding level at size will be strongly affected by the values of the
<code>f0</code> and <code>alpha</code> arguments passed to the
<code><a href="../reference/newCommunityParams.html">newCommunityParams()</a></code> function.</p>
<p>The resource and community spectra are shown in the bottom panel of
the plot (the plotted resource spectrum has been truncated to make for a
better plot, but really extends all the way back to <span class="math inline">\(8.11\times 10^{-11}\)</span> g). You can see that
the community spectrum forms a continuum with the resource spectrum.
This is strongly affected by the level of fixed reproduction rate (the
<code>reproduction</code> argument passed to
<code><a href="../reference/newCommunityParams.html">newCommunityParams()</a></code>)</p>
<p>Note the hump in the biomass at the largest end of the community
spectrum. This is because the size spectrum model can be broadly
described as ‘big things eating little things’. Given this, what is
eating the very biggest things? Without fishing pressure, the mortality
of the largest individuals is only from the external mortality
(determined by the <code>z0</code> argument) and the mortality from
predation is almost 0. This is difficult to see in the plot due to the
predation mortality being so high for the smaller individuals.</p>
<p>We can see this more clearly by extracting the predation mortality
information from the <code>MizerSim</code> object, <code>sim</code>,
that we created above. This is easily done by using the
<code><a href="../reference/getPredMort.html">getPredMort()</a></code> function (see the help page for more
details). There are several functions that can be used for extracting
information from a <code>MizerSim</code> object,
e.g. <code><a href="../reference/getFeedingLevel.html">getFeedingLevel()</a></code> and <code><a href="../reference/getFMort.html">getFMort()</a></code>. For
more information see <a href="exploring_the_simulation_results.html">the
section on exploring the simulation results</a>. Here we just call
<code><a href="../reference/getPredMort.html">getPredMort()</a></code> using the <code>sim</code> object:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_mort</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getPredMort.html">getPredMort</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<p>The resulting <code>pred_mort</code> object is an array that contains
the predation mortality at time by species by size. Here we only have
one species so the species dimension is dropped, leaving us with a two
dimensional array of time by size. We projected the model for <span class="math inline">\(50\)</span> time steps but the length of the time
dimension is <span class="math inline">\(51\)</span> as the initial
population is also included as a time step. We can get the index of the
final time with</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/finalN.html">idxFinalT</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 51</span></span></code></pre>
<p>To pull out the predation mortality at size in the final time step we
use:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_mort_final</span> <span class="op">&lt;-</span> <span class="va">pred_mort</span><span class="op">[</span><span class="fu"><a href="../reference/finalN.html">idxFinalT</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<p>If you plot this predation mortality on a log-log scale you can see
how the predation mortality declines to almost zero for the largest
sizes.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="../reference/w.html">w</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">pred_mort_final</span>, log <span class="op">=</span> <span class="st">"xy"</span>, type <span class="op">=</span> <span class="st">"l"</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"Size [g]"</span>, ylab <span class="op">=</span> <span class="st">"Predation mortality [1/year]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="community_model_files/figure-html/print_plot_comm_m2-1.png" alt="The plot shows the predation mortality at size in the final time step of the community model projection. The x-axis is on a log scale. The predation mortality declines to almost zero for the largest sizes." width="700"></p>
<p>Note how we used <code>w(sim)</code> to get the vector of sizes to
plot along the x-axis and how we specified that we wanted to have
logarithmic axes.</p>
<p>In the long run it is worthwhile to use the ggplot2 package for
creating plots, so we show also how you would create the above graph
with <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code>. For more detail see the section on <a href="plotting.html">using ggplot2 and plotly with mizer</a>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="../reference/w.html">w</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">pred_mort_final</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sd</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Size [g]"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Predation mortality [1/year]"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced</span></span>
<span><span class="co">## infinite values.</span></span></code></pre>
<p><img src="community_model_files/figure-html/unnamed-chunk-4-1.png" alt="The plot shows the predation mortality at size in the final time step of the community model projection. This plot was created with ggplot2." width="700"></p>
</div>
<div class="section level2">
<h2 id="sec:trophic_cascade_comm_model">Example of a trophic cascade with the community model<a class="anchor" aria-label="anchor" href="#sec:trophic_cascade_comm_model"></a>
</h2>
<p>It is possible to use the community model to simulate a trophic
cascade. To do this we need to perform two simulations, one with fishing
and one without.</p>
<p>This means we need to consider how fishing is handled in
<code>mizer</code>. The <code><a href="../reference/newCommunityParams.html">newCommunityParams()</a></code> function
automatically sets the fishing selectivity to have a knife-edge shape,
with only individuals larger than 1 kg selected (the size at the
knife-edge can be changed by setting the <code>knife_edge_size</code>
argument). Although it is possible to change the selectivity function,
here we will use the default knife-edge selectivity. We set up the
parameter object with default parameters:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_knife</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommunityParams.html">newCommunityParams</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>First we perform a simulation without fishing in the same way we did
above by setting the <code>effort</code> argument to 0:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span><span class="va">params_knife</span>, effort <span class="op">=</span> <span class="fl">0</span>, t_max <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p>Now we want to simulate again, this time with fishing. In the
simulations, fishing mortality is calculated as the product of the
fishing selectivity, effort and catchability (see <a href="multispecies_model.html#sec:fishing_gear">the section on fishing
gears</a> for more details). By default catchability is set to 1. This
means that a fishing effort of 1 will result in a fishing mortality of
1/year for fully selected sizes. Here we run a simulation with fishing
effort set to 1 for the duration of the simulation:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span><span class="va">params_knife</span>, effort <span class="op">=</span> <span class="fl">1</span>, t_max <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p>You can compare the difference between these scenarios by using the
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method as before. Of particular interest is the
fishing mortality at size. The knife-edge selectivity at 1000 g can be
clearly seen and an effort of 1 has resulted in a fishing mortality of 1
for the fully selected sizes.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim1</span>, power <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="community_model_files/figure-html/print_plot_comm_fmort-1.png" alt="A summary plot of the simulation with fishing." width="700"></p>
<p>To explore the presence of a trophic cascade, we are interested in
looking at the relative change in abundance when the community is fished
compared to when it is not fished. To do this we need to get the
abundances at size from the simulation objects. This is done with the
<code><a href="../reference/N.html">N()</a></code> function, which returns a three dimensional array with
dimensions time x species x size. Here we have 51 time steps (50 from
the simulation plus one which stores the initial population), 1 species
and 100 sizes:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu"><a href="../reference/N.html">N</a></span><span class="op">(</span><span class="va">sim0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  51   1 100</span></span></code></pre>
<p>We want the abundances in the final time step, and we can use these
to calculate the relative abundances:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">relative_abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/N.html">N</a></span><span class="op">(</span><span class="va">sim1</span><span class="op">)</span><span class="op">[</span><span class="fl">51</span>, , <span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="../reference/N.html">N</a></span><span class="op">(</span><span class="va">sim0</span><span class="op">)</span><span class="op">[</span><span class="fl">51</span>, , <span class="op">]</span></span></code></pre></div>
<p>For convenience, to save you from having to determine the index of
the final time, mizer provides the function <code><a href="../reference/finalN.html">finalN()</a></code>, so we
could have done</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">relative_abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/finalN.html">finalN</a></span><span class="op">(</span><span class="va">sim1</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="../reference/finalN.html">finalN</a></span><span class="op">(</span><span class="va">sim0</span><span class="op">)</span></span></code></pre></div>
<p>This can then be plotted using basic R plotting commands.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="../reference/w.html">w</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">relative_abundance</span>, log <span class="op">=</span> <span class="st">"x"</span>, type <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"Size (g)"</span>, ylab <span class="op">=</span> <span class="st">"Relative abundance"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="../reference/w.html">w</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">relative_abundance</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="../reference/w.html">w</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="../reference/w.html">w</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="community_model_files/figure-html/plot_relative_comm_abund-1.png" alt="The plot shows the relative abundance of the community when fished compared to when not fished." width="700"></p>
<p>The impact of fishing on species larger than 1000g can be clearly
seen. The fishing pressure lowers the abundance of large fish (the
decrease in relative abundance at 1000 g). This then relieves the
predation pressure on their smaller prey (the preferred predator-prey
size ratio is given by the <span class="math inline">\(\beta\)</span>
parameter, which is set to 100 by default), leading to an increase in
their abundance. This in turn increases the predation mortality on their
smaller prey, which reduces their abundance and so on.</p>
</div>
<div class="section level2">
<h2 id="sec:comm_model_change_sigma">The impact of changing <span class="math inline">\(\sigma\)</span><a class="anchor" aria-label="anchor" href="#sec:comm_model_change_sigma"></a>
</h2>
<p>As described above, the <span class="math inline">\(\sigma\)</span>
parameter determines the width of the predator prey size preference.
Here we take a look at how changing the value of <span class="math inline">\(\sigma\)</span> can affect the dynamics of the
community.</p>
<p>In the examples above, <span class="math inline">\(\sigma\)</span> is
set in the <code><a href="../reference/newCommunityParams.html">newCommunityParams()</a></code> function by default to a
value of <span class="math inline">\(2\)</span>. We can see this by
looking at the <code>sigma</code> column of the species_params data
frame that is contained in the MizerParams object:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/species_params.html">species_params</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2</span></span></code></pre>
<p>When projected through time, the community abundances converge to a
stable equilibrium. What happens if we reduce the value of <span class="math inline">\(\sigma\)</span>, for example by setting it to 1.0?
We can do this by passing in the new value of <span class="math inline">\(\sigma\)</span> into
<code><a href="../reference/newCommunityParams.html">newCommunityParams()</a></code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_sigma1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommunityParams.html">newCommunityParams</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We want to project this new model through time using the
<code><a href="../reference/project.html">project()</a></code> function. Here we project the new parameter
object for 50 time steps without fishing and save at intervals of 0.1
years (<code>t_save = 0.1</code>):</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_sigma1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span><span class="va">params_sigma1</span>, effort <span class="op">=</span> <span class="fl">0</span>, t_max <span class="op">=</span> <span class="fl">50</span>, </span>
<span>                      dt <span class="op">=</span> <span class="fl">0.01</span>, t_save <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p>Note that we have introduced a new argument: <span class="math inline">\(dt\)</span>. This is the step size of the solver.
It does not have anything to do with the biology in the model. It only
affects the internal engine of <code><a href="../reference/project.html">project()</a></code> that performs the
projection. As you can see in the underlying model equations in <a href="model_description.html">the model description section</a>, the
model is formulated in continuous time. Therefore, to project it
forward, <code><a href="../reference/project.html">project()</a></code> must solve the system of equations using
numerical methods. The quality of these methods is strongly affected by
<span class="math inline">\(dt\)</span>. The default value of <span class="math inline">\(dt\)</span> is 0.1, which will be fine for most of
the projections we run in this document. Here it is necessary to reduce
the value to 0.01 to avoid introducing any artefacts into the projected
values. Decreasing <span class="math inline">\(dt\)</span> increases the
time it takes to run a projection.</p>
<p>Let’s take a look at how the abundances change through time. We can
do this with the <code><a href="../reference/plotBiomass.html">plotBiomass()</a></code> function:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBiomass.html">plotBiomass</a></span><span class="op">(</span><span class="va">sim_sigma1</span><span class="op">)</span></span></code></pre></div>
<p><img src="community_model_files/figure-html/plot_comm_biomass_sigma1-1.png" alt="The plot shows the biomass of the community through time when the value of sigma is set to 1.0. The abundances no longer converge to a stable equilibrium and the dynamics appear to be chaotic." width="700"></p>
<p>The plot above shows that abundances of the community no longer
converge to a stable equilibrium and the dynamics appear to be chaotic.
The ecological significance of the change in dynamics, and of the
ability of simple community models to show chaotic behaviour, is still
being debated. It can be argued that the size of the oscillations are
too large to be ‘true’. Additionally, when a trait-based model is
implemented, the magnitude of the oscillations are much smaller.</p>
<p>The next section is about <a href="trait_model.html">the trait based
model.</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.york.ac.uk/maths/staff/gustav-delius/" class="external-link">Gustav Delius</a>, Finlay Scott, <a href="http://www.utas.edu.au/profiles/staff/imas/julia-blanchard" class="external-link">Julia Blanchard</a>, <a href="https://ken.haste.dk/" class="external-link">Ken Andersen</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
